/**
 * jquery.pfold.js v1.0.0
 * http://www.codrops.com
 *
 * Licensed under the MIT license.
 * http://www.opensource.org/licenses/mit-license.php
 *
 * Copyright 2012, Codrops
 * http://www.codrops.com
 */
(function(e,t,n){"use strict";var r=e.event,i,s;i=r.special.debouncedresize={setup:function(){e(this).on("resize",i.handler)},teardown:function(){e(this).off("resize",i.handler)},handler:function(e,t){var n=this,o=arguments,u=function(){e.type="debouncedresize",r.dispatch.apply(n,o)};s&&clearTimeout(s),t?u():s=setTimeout(u,i.threshold)},threshold:50};var o=e(t),u=t.Modernizr;e.PFold=function(t,n){this.$el=e(n),this._init(t)},e.PFold.defaults={perspective:1200,speed:450,easing:"linear",folddelay:0,folds:2,folddirection:["right","top"],overlays:!0,centered:!1,containerSpeedFactor:1,containerEasing:"linear",onEndFolding:function(){return!1},onEndUnfolding:function(){return!1}},e.PFold.prototype={_init:function(t){this.options=e.extend(!0,{},e.PFold.defaults,t),this.transEndEventNames={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd",transition:"transitionend"},this.transEndEventName=this.transEndEventNames[u.prefixed("transition")],this.support=u.csstransitions&&u.csstransforms3d,this.support&&(this.$el.css("perspective",this.options.perspective+"px"),this.$el.css("transition","all "+this.options.speed*this.options.folds*this.options.containerSpeedFactor+"ms "+this.options.containerEasing)),this.initialDim={width:this.$el.width(),height:this.$el.height(),left:0,top:0},this._layout(),this.$iContent=this.$el.find(".uc-initial"),this.iContent=this.$iContent.html(),this.$fContent=this.$el.find(".uc-final"),this.fContent=this.$fContent.html(),this.$finalEl=e('<div class="uc-final-wrapper"></div>').append(this.$iContent.clone().hide(),this.$fContent).hide(),this.$el.append(this.$finalEl),this._setDimOffset(),this.opened=!1,this.animating=!1,this._initEvents()},_layout:function(){var t=this.$el.children("div.uc-initial-content"),n=this._getFinalDim(),r=this.$el.children("div.uc-final-content").css({width:n.width,height:n.height});t.wrap('<div class="uc-initial"></div>'),r.show().wrap(e('<div class="uc-final"></div>'))},_initEvents:function(){var e=this;o.on("debouncedresize.pfold",function(t){e._setDimOffset()})},_setDimOffset:function(){this.initialDim.offsetL=this.$el.offset().left-o.scrollLeft(),this.initialDim.offsetT=this.$el.offset().top-o.scrollTop(),this.initialDim.offsetR=o.width()-this.initialDim.offsetL-this.initialDim.width,this.initialDim.offsetB=o.height()-this.initialDim.offsetT-this.initialDim.height},_getTranslationValue:function(){var e=0,t=0,n=0,r=0;for(var i=0;i<this.options.folds;++i){var s=this.options.folddirection[i]||"bottom";switch(s){case"left":e+=this.initialDim.width*Math.pow(2,n)/2,n+=1;break;case"right":e-=this.initialDim.width*Math.pow(2,n)/2,n+=1;break;case"top":t+=this.initialDim.height*Math.pow(2,r)/2,r+=1;break;case"bottom":t-=this.initialDim.height*Math.pow(2,r)/2,r+=1}}return{x:e,y:t}},_getAccumulatedValue:function(){var e=0,t=0,n=0,r=0,i=0,s=0;for(var o=0;o<this.options.folds;++o){var u=this.options.folddirection[o]||"bottom";switch(u){case"left":e+=this.initialDim.width*Math.pow(2,i),i+=1;break;case"right":t+=this.initialDim.width*Math.pow(2,i),i+=1;break;case"top":n+=this.initialDim.height*Math.pow(2,s),s+=1;break;case"bottom":r+=this.initialDim.height*Math.pow(2,s),s+=1}}return{l:e,r:t,t:n,b:r}},_getFinalDim:function(){var e=0,t=0,n=0,r=0,i=0,s=0;for(var o=0;o<this.options.folds;++o){var u=this.options.folddirection[o]||"bottom";switch(u){case"left":case"right":i+=1;break;case"top":case"bottom":s+=1}}return{width:this.initialDim.width*Math.pow(2,i),height:this.initialDim.height*Math.pow(2,s)}},_updateStepStyle:function(e){var t,n,r,i;return e==="fold"?(t=this.lastDirection==="left"||this.lastDirection==="right"?this.lastStyle.width/2:this.lastStyle.width,n=this.lastDirection==="left"||this.lastDirection==="right"?this.lastStyle.height:this.lastStyle.height/2,r=this.lastDirection==="left"?this.lastStyle.left+this.lastStyle.width/2:this.lastStyle.left,i=this.lastDirection==="top"?this.lastStyle.top+this.lastStyle.height/2:this.lastStyle.top):(t=this.lastDirection==="left"||this.lastDirection==="right"?this.lastStyle.width*2:this.lastStyle.width,n=this.lastDirection==="left"||this.lastDirection==="right"?this.lastStyle.height:this.lastStyle.height*2,r=this.lastDirection==="left"?this.lastStyle.left-this.lastStyle.width:this.lastStyle.left,i=this.lastDirection==="top"?this.lastStyle.top-this.lastStyle.height:this.lastStyle.top),{width:t,height:n,left:r,top:i}},_getOppositeDirection:function(e){var t;switch(e){case"left":t="right";break;case"right":t="left";break;case"top":t="bottom";break;case"bottom":t="top"}return t},_start:function(t,n){n|=0;var r=this,i=t==="fold"?{width:this.lastStyle.width,height:this.lastStyle.height,left:this.lastStyle.left,top:this.lastStyle.top}:this.initialDim,s="",o="",u="",a=t==="fold"?this.options.folddirection[this.options.folds-1-n]||"bottom":this.options.folddirection[n]||"bottom",f=t==="fold"?this.options.folddirection[this.options.folds-2-n]||"bottom":"";this.$el.find("div.uc-part").remove();switch(n){case 0:case this.options.folds-1:if(t==="fold"){n===this.options.folds-1&&(i=this.initialDim,s=this.iContent);if(n===0){this._setDimOffset(),this.$el.css({left:0,top:0});var l=this._setLastStep(a,i),o=l.bottom,u=l.top;this.$finalEl.hide().children().hide()}}else{if(n===0){this._setDimOffset();var c=this._getTranslationViewport();this.$el.addClass("uc-current").css({left:c.ftx,top:c.fty}),s=this.iContent,this.$finalEl.hide().children().hide()}else i=this._updateStepStyle(t);if(n===this.options.folds-1)var l=this._setLastStep(a,i),o=l.bottom,u=l.top}break;case this.options.folds:i=t==="fold"?this.initialDim:this._updateStepStyle(t);var h=t==="fold"?0:1;return this.$el.find(".uc-part").remove(),this.$finalEl.css(i).show().children().eq(h).show(),this.opened=t==="fold"?!1:!0,this.animating=!1,t==="fold"?(this.$el.removeClass("uc-current"),this.options.onEndFolding()):this.options.onEndUnfolding(),!1;default:i=this._updateStepStyle(t)}this.support&&(i.transition="all "+this.options.speed+"ms "+this.options.easing);var p="uc-unfold-"+a,d=t==="fold"?"uc-unfold uc-part "+p:"uc-part "+p,v=e('<div class="'+d+'"><div class="uc-front">'+s+'</div><div class="uc-back">'+u+"</div></div>").css(i),m=e('<div class="uc-part uc-single">'+o+"</div>").css(i);this.lastDirection=t==="fold"?f:a,this.lastStyle=i,this.$el.append(m,v),this.options.overlays&&this.support&&this._addOverlays(t,m,v),setTimeout(function(){t==="fold"?v.removeClass("uc-unfold"):v.addClass("uc-unfold"),r.support?v.on(r.transEndEventName,function(e){e.target.className!=="uc-flipoverlay"&&n<r.options.folds&&setTimeout(function(){r._start(t,n+1)},r.options.folddelay)}):r._start(t,n+1);if(r.options.overlays&&r.support){var e=t==="fold"?1:0,i=t==="fold"?.5:0,s=t==="fold"?0:.5;r.$bottomOverlay.css("opacity",e),r.$topBackOverlay.css("opacity",i),r.$topFrontOverlay.css("opacity",s)}},30)},_getTranslationViewport:function(){var e=this._getAccumulatedValue(),t=0,n=0;this.fOffsetL=this.initialDim.offsetL-e.l,this.fOffsetT=this.initialDim.offsetT-e.t,this.fOffsetR=this.initialDim.offsetR-e.r,this.fOffsetB=this.initialDim.offsetB-e.b,this.fOffsetL<0&&(t=Math.abs(this.fOffsetL)),this.fOffsetT<0&&(n=Math.abs(this.fOffsetT)),this.fOffsetR<0&&(t-=Math.abs(this.fOffsetR)),this.fOffsetB<0&&(n-=Math.abs(this.fOffsetB));var r=t,i=n;if(this.options.centered){var s=this._getTranslationValue();s.x>0&&this.fOffsetR+s.x>=0?r=this.fOffsetL>=0?Math.min(s.x,this.fOffsetR):s.x+(t-s.x):s.x<0&&this.fOffsetL+s.x>=0?r=this.fOffsetR>=0?Math.min(s.x,this.fOffsetL):s.x+(t-s.x):r=s.x+(t-s.x),s.y>0&&this.fOffsetB+s.y>=0?i=this.fOffsetT>=0?Math.min(s.y,this.fOffsetB):s.y+(n-s.y):s.y<0&&this.fOffsetT+s.y>=0?i=this.fOffsetB>=0?Math.min(s.y,this.fOffsetT):s.y+(n-s.y):i=s.y+(n-s.y)}return{ftx:0,fty:0}},_setLastStep:function(e,t){var n,r,i="",s="";switch(e){case"bottom":s="margin-top: -"+t.height+"px";break;case"top":i="margin-top: -"+t.height+"px";break;case"left":s="width:"+t.width*2+"px",i="width:"+t.width*2+"px;margin-left: -"+t.width+"px";break;case"right":s="with:"+t.width*2+"px;margin-left: -"+t.width+"px",i="width:"+t.width*2+"px"}n='<div class="uc-inner"><div class="uc-inner-content" style="'+i+'">'+this.fContent+"</div></div>";var o=e==="top"||e==="bottom"?"uc-inner uc-inner-rotate":"uc-inner";return r='<div class="'+o+'"><div class="uc-inner-content" style="'+s+'">'+this.fContent+"</div></div>",{bottom:n,top:r}},_addOverlays:function(t,n,r){var i,s,o;this.$bottomOverlay=e('<div class="uc-overlay"></div>'),this.$topFrontOverlay=e('<div class="uc-flipoverlay"></div>'),this.$topBackOverlay=e('<div class="uc-flipoverlay"></div>'),t==="fold"?(i={transition:"opacity "+this.options.speed/2+"ms "+this.options.easing+" "+this.options.speed/2+"ms"},s={opacity:.5,transition:"opacity "+this.options.speed/2+"ms "+this.options.easing},o={opacity:0,transition:"opacity "+this.options.speed/2+"ms "+this.options.easing}):(i={opacity:1,transition:"opacity "+this.options.speed/2+"ms "+this.options.easing},s={transition:"opacity "+this.options.speed/2+"ms "+this.options.easing},o={opacity:.5,transition:"opacity "+this.options.speed/2+"ms "+this.options.easing+" "+this.options.speed/2+"ms"}),n.append(this.$bottomOverlay.css(i)),r.children("div.uc-front").append(this.$topFrontOverlay.css(s)).end().children("div.uc-back").append(this.$topBackOverlay.css(o))},unfold:function(){if(this.opened||this.animating)return!1;this.animating=!0,this._start("unfold")},fold:function(){if(!this.opened||this.animating)return!1;this.animating=!0,this._start("fold")},getStatus:function(){return this.opened?"opened":"closed"}};var a=function(e){t.console&&t.console.error(e)};e.fn.pfold=function(t){var n=e.data(this,"pfold");if(typeof t=="string"){var r=Array.prototype.slice.call(arguments,1);this.each(function(){if(!n){a("cannot call methods on pfold prior to initialization; attempted to call method '"+t+"'");return}if(!e.isFunction(n[t])||t.charAt(0)==="_"){a("no such method '"+t+"' for pfold instance");return}n[t].apply(n,r)})}else this.each(function(){n?n._init():n=e.data(this,"pfold",new e.PFold(t,this))});return n}})(jQuery,window);